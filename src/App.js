
import { useEffect, useRef, useState } from 'react';
import './App.css';
import Globe from 'react-globe.gl';
import Input from './components/Input';
import { getColour } from './helper';

const countryData = require("./data/country_data.json").features 

function App() {

  const [correctAnswer, setCorrectAnswer] = useState({});
  const [guesses, setGuesses] = useState([])

  const size = 600;
  const data = [{
    "type": "Feature",
    "geometry": {
      "type": "MultiPolygon",
      "coordinates": [
        [
          [
            [77.80034631400014, 35.495405579000135],
            [78.0011609290001, 35.26890777600009],
            [78.2731856690001, 34.658867493000045],
            [78.98539025900004, 34.28635793100001],
            [78.73010868400007, 34.079264629000036],
            [78.82426314300005, 33.46105946900006],
            [79.45609607657275, 33.25039903388836],
            [79.41408948759245, 32.9720529162554],
            [79.62067291506752, 32.72872513425561],
            [79.44349727169374, 32.53477259180094],
            [78.94342899600014, 32.346372986000105],
            [78.63016646300008, 32.57801259400004],
            [78.45798059100014, 32.229661764000085],
            [78.74457808500011, 31.964199931000067],
            [78.73848026600012, 31.334987691000023],
            [79.23831863759511, 31.3296556045226],
            [79.3949776610001, 31.036711324000052],
            [79.83350386600006, 30.96152211500005],
            [80.2528064380001, 30.565008851000087],
            [80.99601688700011, 30.19696930000002],
            [80.36897505700006, 29.757926330000103],
            [80.27874800600006, 29.26808542900001],
            [80.0363855390001, 28.837026469000094],
            [80.34975142400003, 28.620217998000086],
            [80.64833785000008, 28.61975291000006],
            [81.14634362800007, 28.3722486380001],
            [81.30705733200006, 28.1238141890001],
            [81.85565433700009, 27.850936788000055],
            [82.05161136900006, 27.90517120300011],
            [82.75213708500007, 27.49496368400004],
            [83.83408654800013, 27.43403717000008],
            [84.07960127800004, 27.509536438000012],
            [84.5770386150001, 27.329030660000072],
            [84.80193444900004, 27.013752747000083],
            [85.28727950000007, 26.736973776000085],
            [85.59857832800009, 26.854382630000103],
            [85.82161381000009, 26.571712545000096],
            [86.28442793800014, 26.612020162000036],
            [86.71360070900005, 26.414564515000095],
            [87.32622481300007, 26.353327942000064],
            [88.07418949400011, 26.453941955000104],
            [88.1690674240001, 26.74400177000011],
            [87.97073327700008, 27.10273956300007],
            [88.11821781400005, 27.860884501000058],
            [88.61048750800012, 28.105830790000127],
            [88.85388350400007, 27.843676249000097],
            [88.7410221770001, 27.545709941000027],
            [88.89233077000011, 27.315543111000082],
            [88.95454919500008, 26.91262196900003],
            [89.82209314000005, 26.70100697900004],
            [90.38262740100004, 26.891796367000055],
            [90.58778283800007, 26.78007192000011],
            [92.03585982200013, 26.85484771800013],
            [91.97508833800003, 27.472432760000018],
            [91.59505985500004, 27.54638173400012],
            [91.6283394780001, 27.852693787000035],
            [92.06487820550117, 27.76172129397611],
            [92.57497681769904, 27.847806414432647],
            [92.65484012900009, 28.105830790000127],
            [93.44621301300003, 28.671894430000023],
            [93.86307969177443, 28.704870831024095],
            [94.2501829716835, 28.933107498976327],
            [94.6304301350001, 29.319451803000064],
            [95.22491581200012, 29.05936431900001],
            [95.74478072100004, 29.340432435000068],
            [96.14196578000008, 29.368466899000097],
            [96.59800971353144, 28.709910398443995],
            [96.33645875408492, 28.47966681390912],
            [97.11554976400004, 28.366564230000066],
            [97.32349572800013, 28.217477723000073],
            [97.2229333900001, 27.899719341000022],
            [96.87019006400004, 27.61909047500008],
            [96.75887902800008, 27.341743063000123],
            [96.14258589700006, 27.25751047800013],
            [95.3926575110001, 26.69175689800001],
            [95.11908247900004, 26.604217021000025],
            [95.13954634600003, 26.02993682900008],
            [95.00880497300011, 25.73713816300004],
            [94.60800256400012, 25.394626770000073],
            [94.7085649010001, 25.025889587000094],
            [93.99791060400014, 23.916965027000074],
            [93.45665165200006, 23.959959819000076],
            [93.37489953600004, 23.129726257000087],
            [93.07951704900012, 22.772719626000068],
            [93.16902063000003, 22.246911927000028],
            [92.57587854000013, 21.977574362000027],
            [92.49588342300012, 22.695618388000028],
            [92.35687382000003, 23.289122213],
            [92.15078820800005, 23.731653341000126],
            [91.53656213400006, 22.981854146000003],
            [91.30050419200012, 23.14230946900001],
            [91.14082401500013, 23.61209991500006],
            [91.36303267500011, 24.099847921000062],
            [91.59650679500004, 24.104989726000056],
            [92.10758671100012, 24.40597910600006],
            [92.23378055900008, 24.777532654000098],
            [92.45805627500005, 24.953284201000045],
            [92.00175337700006, 25.18296010400006],
            [91.23570194500013, 25.201925354000096],
            [90.36464400300014, 25.149990540000104],
            [89.79501469000007, 25.374162903000112],
            [89.83005131100009, 25.90798044900005],
            [89.35147587100005, 25.996863912000023],
            [88.80799483200008, 26.23343861900007],
            [88.65627282700007, 26.41513295500006],
            [88.16379642800007, 26.140472717000122],
            [88.07439620000008, 25.90813547800009],
            [88.53028568600013, 25.500201721000067],
            [88.77233809500012, 25.501958720000047],
            [88.89863529500013, 25.169317526000057],
            [88.4314803470001, 25.173038229000056],
            [88.02178959200006, 24.64560272200005],
            [88.47540531400011, 24.315467835000064],
            [88.73750817900003, 24.28709747300006],
            [88.54010420800012, 23.64995290100005],
            [88.84277307100012, 22.964568380000017],
            [89.06039472700007, 22.12986888200004],
            [88.76246178500003, 21.555853583000044],
            [88.39307701900003, 21.60024648600006],
            [87.97046959700003, 21.836493231000077],
            [87.70378665500004, 21.655503648000035],
            [87.20093834700003, 21.551988023000035],
            [86.84400475400008, 21.08222077000005],
            [87.00359134200005, 20.657049872000073],
            [86.73389733200008, 20.462225653000075],
            [86.26856530000003, 19.91034577000005],
            [85.54916425900007, 19.690619208000044],
            [85.22095787900008, 19.736029364000046],
            [85.18043053500003, 19.475002346000053],
            [84.87208092500003, 19.219875393000052],
            [84.07740319100003, 18.271551825000074],
            [83.61394290500004, 18.04515208500004],
            [83.23894290500004, 17.592962958000044],
            [82.47486412900008, 17.205959377000056],
            [82.29932701900003, 17.03034088700008],
            [82.30738366000008, 16.579779364000046],
            [81.76295006600003, 16.32257721600007],
            [81.31739342500003, 16.36749909100007],
            [80.99887129000007, 15.84674713700008],
            [80.69044030000003, 15.90070221600007],
            [80.26319420700008, 15.67454661700009],
            [80.05453535200007, 15.014146226000037],
            [80.19695071700005, 14.565008856000077],
            [80.12110436300003, 14.242010809000078],
            [80.23715254000007, 13.839667059000078],
            [80.11939537900008, 13.500677802000041],
            [80.33277428500008, 13.198146877000056],
            [80.15601647200003, 12.47451406500005],
            [79.86182701900003, 12.022040106000077],
            [79.75196373800003, 11.576971747000073],
            [79.85531660200007, 11.159857489000046],
            [79.86378014400003, 10.378729559000078],
            [79.39812259200005, 10.324652411000045],
            [78.98080488400007, 9.667181708000044],
            [78.95679772200003, 9.27484772300005],
            [78.44988040500004, 9.116603908000059],
            [78.17790774800005, 8.861070054000038],
            [78.06275475400008, 8.373195705000057],
            [77.51091556100005, 8.075995184000078],
            [76.99586022200003, 8.368109442000048],
            [76.54395592500003, 8.912502346000053],
            [76.31177819100003, 9.492987372000073],
            [76.35922285200007, 9.915432033000059],
            [76.17750084700003, 10.17064036700009],
            [75.83277428500008, 11.097845770000049],
            [75.53077233200008, 11.69367096600007],
            [75.13086998800003, 12.207831122000073],
            [74.81755618600005, 12.861761786000045],
            [74.61459394600007, 13.835516669000071],
            [74.26319420700008, 14.701605536000045],
            [74.11133873800003, 14.78034088700008],
            [73.88591556100005, 15.435207424000055],
            [73.44703209700003, 16.068915106000077],
            [73.31918379000007, 16.50975169500009],
            [73.23471113400007, 17.30231354400007],
            [72.98096764400003, 18.080552476000037],
            [72.97738691500007, 18.295070705000057],
            [72.65007571700005, 19.84198639500005],
            [72.94499759200005, 20.770005601000037],
            [72.60613040500004, 21.26658763200004],
            [72.53207441500007, 21.71385325700004],
            [72.55307050900007, 22.282456773000035],
            [72.31723066500007, 22.184881903000075],
            [72.16602623800003, 21.79393138200004],
            [72.29566491000008, 21.65387604400007],
            [72.10474694100003, 21.20506419500009],
            [70.98243248800009, 20.710150458000044],
            [70.54151451900003, 20.807847398000035],
            [70.05444521916755, 21.15315547561164],
            [68.99415123800009, 22.203924872000073],
            [68.97437584700003, 22.404730536000045],
            [69.61605879000007, 22.355902411000045],
            [70.17847741000008, 22.56195709800005],
            [70.39877363400007, 22.94550202000005],
            [69.71583092500003, 22.746893622000073],
            [69.23878014400003, 22.841945705000057],
            [68.55225670700008, 23.259711005000042],
            [68.18303470100005, 23.84210846600007],
            [68.72446618700008, 23.965179139000085],
            [68.72591312700007, 24.289216207000024],
            [69.56307133000013, 24.276762187000045],
            [69.97203861500003, 24.16521860800013],
            [70.5629069420001, 24.424091695000058],
            [70.75545332900009, 24.231441956000126],
            [71.06385827700007, 24.682577209],
            [70.64662276300004, 25.431368713000055],
            [70.26457889800014, 25.697295634000014],
            [70.06464278200008, 25.98032745400012],
            [70.15807377100009, 26.53011301700009],
            [69.81556237800004, 26.580290833000035],
            [69.46509281400012, 26.807770487000127],
            [69.57557702600013, 27.18841908800006],
            [70.34193851700013, 28.01146962500009],
            [70.83157271300007, 27.70146270700006],
            [71.86086389200005, 27.95020721500005],
            [72.3821757400001, 28.784006450000092],
            [72.90152388500007, 29.02262237600003],
            [73.23287316900013, 29.536596171000085],
            [73.37033247900007, 29.927321676000034],
            [73.94435428900005, 30.18828765900004],
            [73.85175012200006, 30.372669169000048],
            [74.32975712100006, 30.899613750000114],
            [74.61191044200012, 31.44020090800008],
            [74.48943729700005, 31.711192118000028],
            [74.82864139800012, 32.02543650300002],
            [75.29465946500005, 32.14889150000006],
            [75.02366825400009, 32.46626230900007],
            [74.00233524600009, 33.17769175200009],
            [74.14155155500004, 33.54937449100008],
            [73.99830448400007, 34.19680267400007],
            [73.77485559100006, 34.37095225000009],
            [73.96223433500012, 34.668169251000066],
            [74.28583215300011, 34.76888661700012],
            [75.77711063700013, 34.503812358000104],
            [76.02340051300013, 34.6771609500001],
            [76.55318729700008, 34.72584014900012],
            [77.04897098800006, 35.110441997000024],
            [77.80034631400014, 35.495405579000135]
          ]
        ]
      ]
    },
    "properties": {
      "featurecla": "Admin-0 sovereignty",
      "scalerank": 0,
      "ADMIN": "India",
      "GEOU_DIF": 0,
      "GEOUNIT": "India",
      "SUBUNIT": "India",
      "NAME": "India",
      "NAME_LONG": "India",
      "BRK_NAME": "India",
      "BRK_GROUP": "",
      "ABBREV": "India",
      "POSTAL": "IND",
      "FORMAL_EN": "Republic of India",
      "FORMAL_FR": "",
      "NAME_SORT": "India",
      "NAME_ALT": "",
      "ISO_A2": "IN",
      "ISO_A2_EH": "IN",
      "WB_A2": "IN",
      "WB_A3": "IND",
      "WOE_NOTE": "Exact WOE match as country",
      "CONTINENT": "Asia",
      "REGION_UN": "Asia",
      "SUBREGION": "Southern Asia",
      "REGION_WB": "South Asia",
      "NAME_LEN": 5,
      "LONG_LEN": 5,
      "ABBREV_LEN": 5,
      "FLAG": "IN",
      "NAME_AR": "الهند",
      "NAME_BN": "ভারত",
      "NAME_DE": "Indien",
      "NAME_EN": "India",
      "NAME_ES": "India",
      "NAME_FA": "هند",
      "NAME_FR": "Inde",
      "NAME_EL": "Ινδία",
      "NAME_HE": "הודו",
      "NAME_HI": "भारत",
      "NAME_HU": "India",
      "NAME_ID": "India",
      "NAME_IT": "India",
      "NAME_JA": "インド",
      "NAME_KO": "인도",
      "NAME_NL": "India",
      "NAME_PL": "Indie",
      "NAME_PT": "Índia",
      "NAME_RU": "Индия",
      "NAME_SV": "Indien",
      "NAME_TR": "Hindistan",
      "NAME_UK": "Індія",
      "NAME_UR": "بھارت",
      "NAME_VI": "Ấn Độ",
      "NAME_ZH": "印度",
      "NAME_ZHT": "印度"
    },
    "bbox": [
      68.18303470100005, 8.075995184000078, 97.32349572800013,
      35.495405579000135
    ]
  }]

  function getLabel(country) {
    const name = country.properties.ADMIN;
    const label = `<b class="tooltip">${name}</b>`;
    return label;
  }

  function polygonColour(country) {


    // return "yellow"
    return getColour(
      country,
      correctAnswer
    );

    // const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange', 'pink', 'brown'];
    // const randomIndex = Math.floor(Math.random() * colors.length);
    // return colors[randomIndex];
  }

  function polygonSideColor(country) {
    return "black"
  }

  function getAltitude(country) {
    return 0.05
  }


  const globeEl = useRef();

  useEffect(() => {
    const controls = globeEl.current.controls();
    controls.autoRotate = true;
    controls.autoRotateSpeed = 1;
    setTimeout(() => {
      globeEl.current.pointOfView({ lat: 0, lng: 0, altitude: 1.6 });
    }, 400);
  }, [globeEl]);

  useEffect(() => {
    if (globeEl.current) {
      // Disable zooming
      globeEl.current.controls().enableZoom = false;
    }
  }, []);


  useEffect(()=>{
    const answer = countryData[Math.floor(Math.random() * countryData.length)];
    setCorrectAnswer(answer)
  }, [])


  console.log("Correct answer: ", correctAnswer?.properties?.NAME_EN)
  console.log(guesses)

  return (
    <div className="App">

      <Input guesses={guesses} setGuesses={setGuesses} correctAnswer={correctAnswer}/>
      <div 
      className="globe"
      >
      <Globe
       ref={globeEl}
      globeImageUrl="//unpkg.com/three-globe/example/img/earth-day.jpg"
      backgroundColor="#00000000"
      polygonsData={guesses}
      polygonLabel={getLabel}
      polygonCapColor={polygonColour}
      polygonSideColor={polygonSideColor}
      polygonAltitude={getAltitude}
      polygonStrokeColor={() => 'black'}
      height={size}
      width={size}
      enableZoom={false}
    />
      </div>
     
    </div>
  );
}

export default App;
